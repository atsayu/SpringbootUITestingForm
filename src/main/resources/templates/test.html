<html>
  <head>
    <style>
      :root {
        grey: #bdbdbd;
        white: #fefffe;
        black: #282627;
      }

      .item1 {
        grid-area: main;
      }

      .item2 {
        grid-area: custom;
      }
      .item3 {
        grid-area: gap;
        background-color: grey;
      }

      .grid-container {
        display: grid;
        grid-template-areas: "main gap custom";
        grid-template-columns: 63% 0.5% 35%;
        column-gap: 0px;
        width: 100%;
        height: 100%;
      }

      .save {
        background-color: white;
        color: grey;
        border: 2px solid grey;
        width: 100px;
        position: relative;
        left: 40%;
        border-radius: 5px;
        margin-bottom: 10px;
      }

      .new-testcase {
        background-color: white;
        color: grey;
        border: 2px solid grey;
        width: 100px;
        position: relative;
        left: 40%;
        border-radius: 5px;
        margin-bottom: 10px;
      }

      /* Add the following styles to your existing CSS */

      #myTable {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      #myTable th,
      #myTable td {
        border: 1px solid grey;
        padding: 8px;
        text-align: left;
      }

      #myTable th {
        background-color: #282627;
        color: white;
      }

      #myTable td {
        background-color: #fefffe;
        color: #282627;
      }

      #myTable tr:hover {
        background-color: #bdbdbd;
      }

      #myTable button {
        padding: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="grid-container">
      <div class="item1">
      <noscript>
 You need to enable JavaScript to run this app.
</noscript>
      <div id="root">
 <div class="login_container">
  <div class="login_logo">
   Swag Labs
  </div>
  <div class="login_wrapper">
   <div class="login_wrapper-inner">
    <div id="login_button_container" class="form_column">
     <div class="login-box">
      <form>
       <div class="form_group">
        <input class="input_error form_input" placeholder="Username" type="text" data-test="username" id="user-name" name="user-name" autocorrect="off" autocapitalize="none" value="" cong="valid_username">
       </div>
       <div class="form_group">
        <input class="input_error form_input" placeholder="Password" type="password" data-test="password" id="password" name="password" autocorrect="off" autocapitalize="none" value="" cong="valid_password">
       </div>
       <div class="error-message-container"></div><input type="submit" class="submit-button btn_action" data-test="login-button" id="login-button" name="login-button" value="Login" cong>
      </form>
     </div>
    </div>
   </div>
   <div class="login_credentials_wrap">
    <div class="login_credentials_wrap-inner">
     <div id="login_credentials" class="login_credentials">
      <h4>Accepted usernames are:</h4>standard_user
      <br>
      locked_out_user
      <br>
      problem_user
      <br>
      performance_glitch_user
      <br>
      error_user
      <br>
      visual_user
      <br>
     </div>
     <div class="login_password">
      <h4>Password for all users:</h4>secret_sauce
     </div>
    </div>
   </div>
  </div>
 </div>
</div>
      <script>!function(e){function r(r){for(var n,p,l=r[0],a=r[1],f=r[2],c=0,s=[];c<l.length;c++)p=l[c],Object.prototype.hasOwnProperty.call(o,p)&&o[p]&&s.push(o[p][0]),o[p]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(i&&i(r);s.length;)s.shift()();return u.push.apply(u,f||[]),t()}function t(){for(var e,r=0;r<u.length;r++){for(var t=u[r],n=!0,l=1;l<t.length;l++){var a=t[l];0!==o[a]&&(n=!1)}n&&(u.splice(r--,1),e=p(p.s=t[0]))}return e}var n={},o={1:0},u=[];function p(r){if(n[r])return n[r].exports;var t=n[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,p),t.l=!0,t.exports}p.m=e,p.c=n,p.d=function(e,r,t){p.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},p.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},p.t=function(e,r){if(1&r&&(e=p(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(p.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)p.d(t,n,function(r){return e[r]}.bind(null,n));return t},p.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return p.d(r,"a",r),r},p.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},p.p="/";var l=this["webpackJsonpsample-app-web"]=this["webpackJsonpsample-app-web"]||[],a=l.push.bind(l);l.push=r,l=l.slice();for(var f=0;f<l.length;f++)r(l[f]);var i=a;t()}([])</script>
      <script src="/static/js/2.9b02e67e.chunk.js"></script>
      <script src="/static/js/main.9735b7ab.chunk.js"></script>
</div>
  <div class="item3"></div>
      <div class="item2">
        <button id="new-testcase" class="new-testcase" type="button">
          New Testcase
        </button>
        <br />
        <button id="save" class="save" type="button">Save</button>
        <br />
        <table id="myTable"></table>
      </div>
    </div>
    <script>
      let inputValArr = [];
      let allElement = document.getElementsByTagName("*");
      let inputElement = [];
      for (let i = 0; i < allElement.length; i++) {
        if (
          allElement[i].hasAttribute("cong") &&
          allElement[i].getAttribute("cong").length != 0
        ) {
          if (allElement[i].tagName.localeCompare("TEXTAREA")) {
            inputElement.push(allElement[i]);
          } else if (allElement[i].tagName.localeCompare("INPUT")) {
            if (allElement[i].hasAttribute("type")) {
              let typeAttributeValue = allElement[i].getAttribute("type");
              if (
                typeAttributeValue.localeCompare("submit") != 0 &&
                typeAttributeValue.localeCompare("button") != 0 &&
                typeAttributeValue.localeCompare("reset") != 0 &&
                typeAttributeValue.localeCompare("image") != 0 &&
                typeAttributeValue.localeCompare("hidden") != 0
              ) {
                inputElement.push(allElement[i]);
              }
            } else {
              inputElement.push(allElement[i]);
            }
          }
        }
      }
      let numberInputElements = inputElement.length;
      function attributeElement(e) {
        return e.getAttribute("cong");
      }

const saveButton = document.getElementById("save");
      saveButton.addEventListener("click", function () {
 console.log(inputValArr);
      let inputValues = [];
      for (let i = 0; i < numberInputElements; i++) {
        inputValues.push(attributeElement(inputElement[i]));
      }
      for (let i = 0; i < inputValArr.length; i++) {
        for (let k = 0; k < numberInputElements; k++) {
          inputValues.push(inputValArr[i][k]);
        }
      }
      console.log(inputValues);        let fileContent = "";
        for (let i = 0; i < numberInputElements; i++) {
          for (let k = i; k < inputValues.length; k += numberInputElements) {
            if (
              k <
              i +
                (inputValues.length / numberInputElements - 1) *
                  numberInputElements
            ) {
              fileContent += inputValues[k] + ",";
            } else {
              fileContent += inputValues[k] + "\n";
            }
          }
        }         let xhr = new XMLHttpRequest();
         xhr.open("POST", "/createtest");
         // xhr.setRequestHeader("Accept", "application/json");
         xhr.setRequestHeader("Content-Type", "application/json");
         let data = {
          "values" : fileContent,
         }
         xhr.onload = () => {
          if (xhr.readyState === 4 && xhr.status === 200) {
           window.location.href = '/script';
          } else {
           console.log(`Error: ${xhr.status}`);
          }
         };

         xhr.send(JSON.stringify(data));
        });
      const newTestcaseButton = document.getElementById("new-testcase");
      newTestcaseButton.addEventListener("click", function () {
        // for (let i = 0; i < numberInputElements; i++) {
        //   if (inputElement[i].value.length == 0) {
        //     inputValues.push("null");
        //   } else {
        //     inputValues.push(inputElement[i].value);
        //   }

        // }
        var table = document.getElementById("myTable");
        var row = table.insertRow();
        var val = "";
        var valArr = [];
        if (table.rows.length == 1) {
          var headerRow = table.insertRow(0);
          var thead = table.createTHead();
          var index_cell = headerRow.insertCell();
          index_cell.innerHTML = "Index";
          var index_cell = headerRow.insertCell();
          index_cell.innerHTML = "Value";
          var index_cell = headerRow.insertCell();
          index_cell.innerHTML = "Action";
        }
        for (let i = 0; i < numberInputElements; i++) {
          valArr.push(inputElement[i].value);
          if (i != 0) {
            val += ", " + inputElement[i].value;
          } else {
            val += inputElement[i].value;
          }
        }
        inputValArr.push(valArr);
        var index_cell = row.insertCell(0);
        index_cell.innerHTML = table.rows.length - 1;

        var val_cell = row.insertCell(1);

        if (val.length > 20) {
          // Display only a part of the text if it's too long
          val_cell.innerHTML =
            val.substring(0, 20) + "<span class='ellipsis'> ...</span>";
          // Add a button to expand and show the full value
          val_cell.innerHTML += `<button class='expand-button' onclick='expandText(this, &#39${val}&#39)'>Expand</button>`;
        } else {
          val_cell.innerHTML = val;
        }

        var cell_action = row.insertCell(2);
        cell_action.innerHTML =
          "<button onclick='deleteRow(this)'>Delete</button> <button onclick='editRow(this)'>Change</button>";

        // Function to expand and show the full value

        for (let i = 0; i < numberInputElements; i++) {
          inputElement[i].value = null;
        }
      });

      function expandText(button, fullText) {
        var cell = button.parentNode;
        cell.innerHTML =
          fullText + "<button onclick='collapseText(this)'>Collapse</button>";
      }

      // Function to collapse the text
      function collapseText(span) {
        var cell = span.parentNode;
        var val = cell.innerText;
        cell.innerHTML =
          val.substring(0, 20) +
          "<span class='ellipsis'> ...</span>" +
          "<button class='expand-button' onclick='expandText(this, \"" +
          val.substring(0, val.length - 8) +
          "\")'>Expand</button>";
      }

      function deleteRow(row) {
        var i = row.parentNode.parentNode.rowIndex;
        document.getElementById("myTable").deleteRow(i);
      }

      function editRow(button) {
        var i = button.parentNode.parentNode.rowIndex;
        var table = document.getElementById("myTable");
        for (var index in inputElement) {
          inputElement[index].value = inputValArr[i-1][index];
        }
        
        button.innerHTML = 'Save';  
        button.setAttribute("onclick", "saveRow(this);")
      }

      function saveRow(button) {
        var i = button.parentNode.parentNode.rowIndex;
        var table = document.getElementById("myTable");
        var val = '';
        for (var index in inputElement) {
          if (index == 0) {
            val += inputElement[index].value;
          } else {
            val += ', ' + inputElement[index].value;
          }
          inputValArr[i-1][index] = inputElement[index].value;
        }
        var editableRow = table.rows.item(i);

        if (val.length > 20) {
          // Display only a part of the text if it's too long
          editableRow.cells[1].innerHTML =
            val.substring(0, 20) + "<span class='ellipsis'> ...</span>";
          // Add a button to expand and show the full value
          editableRow.cells[1].innerHTML += `<button class='expand-button' onclick='expandText(this, &#39${val}&#39)'>Expand</button>`;
        } else {
          editableRow.cells[1].innerHTML = val;
        }
        button.innerHTML = 'Edit';  
        button.setAttribute("onclick", "editRow(this);")
      }
    </script>
  </body>
</html>